/***Copyright(c)MetaPlatforms,Inc.andaffiliates.**ThissourcecodeislicensedundertheMITlicensefoundinthe*LICENSEfileintherootdirectoryofthissourcetree.**@flow*/import*asReactfrom'react';import{Fragment,useContext,useEffect}from'react';import{ModalDialogContext}from'./ModalDialog';import{StoreContext}from'./context';import{currentBridgeProtocol}from'react-devtools-shared/src/bridge';importButtonfrom'./Button';importButtonIconfrom'./ButtonIcon';import{copy}from'clipboard-js';importstylesfrom'./UnsupportedBridgeProtocolDialog.css';importtype{BridgeProtocol}from'react-devtools-shared/src/bridge';constDEVTOOLS_VERSION=process.env.DEVTOOLS_VERSION;constINSTRUCTIONS_FB_URL='https://fb.me/devtools-unsupported-bridge-protocol';constMODAL_DIALOG_ID='UnsupportedBridgeProtocolDialog';exportdefaultfunctionUnsupportedBridgeProtocolDialog(_:{}):null{const{dialogs,dispatch}=useContext(ModalDialogContext);conststore=useContext(StoreContext);constisVisible=!!dialogs.find(dialog=>dialog.id===MODAL_DIALOG_ID);useEffect(()=>{constupdateDialog=()=>{if(!isVisible){if(store.unsupportedBridgeProtocolDetected){dispatch({canBeDismissed:false,id:MODAL_DIALOG_ID,type:'SHOW',content:(<DialogContentunsupportedBridgeProtocol={store.bridgeProtocol}/>),});}}else{if(!store.unsupportedBridgeProtocolDetected){dispatch({type:'HIDE',id:MODAL_DIALOG_ID,});}}};updateDialog();store.addListener('unsupportedBridgeProtocolDetected',updateDialog);return()=>{store.removeListener('unsupportedBridgeProtocolDetected',updateDialog);};},[isVisible,store]);returnnull;}functionDialogContent({unsupportedBridgeProtocol,}:{unsupportedBridgeProtocol:BridgeProtocol,}){const{version,minNpmVersion,maxNpmVersion}=unsupportedBridgeProtocol;letinstructions;if(maxNpmVersion===null){constupgradeInstructions=`npmi-greact-devtools@^${minNpmVersion}`;instructions=(<><pclassName={styles.Paragraph}>Tofixthis,upgradetheDevToolsNPMpackage:</p><preclassName={styles.NpmCommand}>{upgradeInstructions}<ButtononClick={()=>copy(upgradeInstructions)}title="Copyupgradecommandtoclipboard"><ButtonIcontype="copy"/></Button></pre></>);}else{constdowngradeInstructions=`npmi-greact-devtools@${maxNpmVersion}`;instructions=(<><pclassName={styles.Paragraph}>Tofixthis,downgradetheDevToolsNPMpackage:</p><preclassName={styles.NpmCommand}>{downgradeInstructions}<ButtononClick={()=>copy(downgradeInstructions)}title="Copydowngradecommandtoclipboard"><ButtonIcontype="copy"/></Button></pre></>);}return(<Fragment><divclassName={styles.Column}><divclassName={styles.Title}>UnsupportedDevToolsbackendversion</div><pclassName={styles.Paragraph}>Youarerunning<code>react-devtools</code>version{''}<spanclassName={styles.Version}>{DEVTOOLS_VERSION}</span>.</p><pclassName={styles.Paragraph}>Thisrequiresbridgeprotocol{''}<spanclassName={styles.Version}>version{currentBridgeProtocol.version}</span>.Howeverthecurrentbackendversionusesbridgeprotocol{''}<spanclassName={styles.Version}>version{version}</span>.</p>{instructions}<pclassName={styles.Paragraph}>Or{''}<aclassName={styles.Link}href={INSTRUCTIONS_FB_URL}target="_blank">clickhere</a>{''}formoreinformation.</p></div></Fragment>);}