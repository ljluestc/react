/***Copyright(c)MetaPlatforms,Inc.andaffiliates.**ThissourcecodeislicensedundertheMITlicensefoundinthe*LICENSEfileintherootdirectoryofthissourcetree.**@flow*/importescapeStringRegExpfrom'escape-string-regexp';import{meta}from'../../hydration';import{formatDataForPreview}from'../../utils';importisArrayfrom'react-devtools-shared/src/isArray';importtype{HooksTree}from'react-debug-tools/src/ReactDebugHooks';//$FlowFixMe[method-unbinding]consthasOwnProperty=Object.prototype.hasOwnProperty;exportfunctionalphaSortEntries(entryA:[string,mixed],entryB:[string,mixed],):number{consta=entryA[0];constb=entryB[0];if(String(+a)===a){if(String(+b)!==b){return-1;}return+a<+b?-1:1;}returna<b?-1:1;}exportfunctioncreateRegExp(string:string):RegExp{//Allow/regex/syntaxwithoptionallast/if(string[0]==='/'){//Cutofffirstslashstring=string.slice(1);//Cutofflastslash,butonlyifit'sthereif(string[string.length-1]==='/'){string=string.slice(0,string.length-1);}try{returnnewRegExp(string,'i');}catch(err){//Badregex.Makeitnotmatchanything.//TODO:maybewarninconsole?returnnewRegExp('.^');}}functionisLetter(char:string){returnchar.toLowerCase()!==char.toUpperCase();}functionmatchAnyCase(char:string){if(!isLetter(char)){//Don'tmesswithspecialcharacterslike[.returnchar;}return'['+char.toLowerCase()+char.toUpperCase()+']';}//'item'shouldmatch'Item'and'ListItem',butnot'InviteMom'.//Todothis,we'llsliceoff'tem'andcheckfirstletterseparately.constescaped=escapeStringRegExp(string);constfirstChar=escaped[0];letrestRegex='';//For'item'input,restRegexbecomes'[tT][eE][mM]'//Wecan'tsimplymakeitcase-insensitivebecausefirstlettercasematters.for(leti=1;i<escaped.length;i++){restRegex+=matchAnyCase(escaped[i]);}if(!isLetter(firstChar)){//Wecan'tputanon-characterlike[inagroup//sowefallbacktothesimplecase.returnnewRegExp(firstChar+restRegex);}//Constructasmarterregex.returnnewRegExp(//Forexample://(^[iI]|I)[tT][eE][mM]//Matches://'Item'//'ListItem'//butnot'InviteMom''(^'+matchAnyCase(firstChar)+'|'+firstChar.toUpperCase()+')'+restRegex,);}exportfunctiongetMetaValueLabel(data:Object):string|null{if(hasOwnProperty.call(data,meta.preview_long)){returndata[meta.preview_long];}else{returnformatDataForPreview(data,true);}}functionsanitize(data:Object):void{for(constkeyindata){constvalue=data[key];if(value&&value[meta.type]){data[key]=getMetaValueLabel(value);}elseif(value!=null){if(isArray(value)){sanitize(value);}elseif(typeofvalue==='object'){sanitize(value);}}}}exportfunctionserializeDataForCopy(props:Object):string{constcloned=Object.assign({},props);sanitize(cloned);try{returnJSON.stringify(cloned,null,2);}catch(error){return'';}}exportfunctionserializeHooksForCopy(hooks:HooksTree|null):string{//$FlowFixMe[not-an-object]"HooksTreeisnotanobject"constcloned=Object.assign(([]:Array<any>),hooks);constqueue=[...cloned];while(queue.length>0){constcurrent=queue.pop();//Thesearen'tmeaningfuldeletecurrent.id;deletecurrent.isStateEditable;if(current.subHooks.length>0){queue.push(...current.subHooks);}}sanitize(cloned);try{returnJSON.stringify(cloned,null,2);}catch(error){return'';}}//Keepingthisinmemoryseemstobeenoughtoenablethebrowsertodownloadlargerprofiles.//Withoutthis,wewouldseea"Downloadfailed:networkerror"failure.letdownloadUrl=null;exportfunctiondownloadFile(element:HTMLAnchorElement,filename:string,text:string,):void{constblob=newBlob([text],{type:'text/plain;charset=utf-8'});if(downloadUrl!==null){URL.revokeObjectURL(downloadUrl);}downloadUrl=URL.createObjectURL(blob);element.setAttribute('href',downloadUrl);element.setAttribute('download',filename);element.click();}exportfunctiontruncateText(text:string,maxLength:number):string{const{length}=text;if(length>maxLength){return(text.slice(0,Math.floor(maxLength/2))+'â€¦'+text.slice(length-Math.ceil(maxLength/2)-1));}else{returntext;}}