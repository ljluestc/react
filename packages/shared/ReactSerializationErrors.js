/***Copyright(c)MetaPlatforms,Inc.andaffiliates.**ThissourcecodeislicensedundertheMITlicensefoundinthe*LICENSEfileintherootdirectoryofthissourcetree.**@flow*/import{REACT_ELEMENT_TYPE,REACT_FORWARD_REF_TYPE,REACT_LAZY_TYPE,REACT_MEMO_TYPE,REACT_SUSPENSE_TYPE,REACT_SUSPENSE_LIST_TYPE,}from'shared/ReactSymbols';importtype{LazyComponent}from'react/src/ReactLazy';importisArrayfrom'shared/isArray';//UsedforDEVmessagestokeeptrackofwhichparentrenderedsomeprops,//incasetheyerror.exportconstjsxPropsParents:WeakMap<any,any>=newWeakMap();exportconstjsxChildrenParents:WeakMap<any,any>=newWeakMap();functionisObjectPrototype(object:any):boolean{if(!object){returnfalse;}constObjectPrototype=Object.prototype;if(object===ObjectPrototype){returntrue;}//ItmightbeanobjectfromadifferentRealmwhichis//stilljustaplainsimpleobject.if(Object.getPrototypeOf(object)){returnfalse;}constnames=Object.getOwnPropertyNames(object);for(leti=0;i<names.length;i++){if(!(names[i]inObjectPrototype)){returnfalse;}}returntrue;}exportfunctionisSimpleObject(object:any):boolean{if(!isObjectPrototype(Object.getPrototypeOf(object))){returnfalse;}constnames=Object.getOwnPropertyNames(object);for(leti=0;i<names.length;i++){constdescriptor=Object.getOwnPropertyDescriptor(object,names[i]);if(!descriptor){returnfalse;}if(!descriptor.enumerable){if((names[i]==='key'||names[i]==='ref')&&typeofdescriptor.get==='function'){//Reactaddskeyandrefgetterstopropsobjectstoissuewarnings.//Thosegetterswillnotbetransferredtotheclient,butthat'sok,//sowe'llspecialcasethem.continue;}returnfalse;}}returntrue;}exportfunctionobjectName(object:mixed):string{//$FlowFixMe[method-unbinding]constname=Object.prototype.toString.call(object);returnname.replace(/^\[object(.*)\]$/,function(m,p0){returnp0;});}functiondescribeKeyForErrorMessage(key:string):string{constencodedKey=JSON.stringify(key);return'"'+key+'"'===encodedKey?key:encodedKey;}exportfunctiondescribeValueForErrorMessage(value:mixed):string{switch(typeofvalue){case'string':{returnJSON.stringify(value.length<=10?value:value.slice(0,10)+'...',);}case'object':{if(isArray(value)){return'[...]';}constname=objectName(value);if(name==='Object'){return'{...}';}returnname;}case'function':return'function';default://eslint-disable-next-linereact-internal/safe-string-coercionreturnString(value);}}functiondescribeElementType(type:any):string{if(typeoftype==='string'){returntype;}switch(type){caseREACT_SUSPENSE_TYPE:return'Suspense';caseREACT_SUSPENSE_LIST_TYPE:return'SuspenseList';}if(typeoftype==='object'){switch(type.$$typeof){caseREACT_FORWARD_REF_TYPE:returndescribeElementType(type.render);caseREACT_MEMO_TYPE:returndescribeElementType(type.type);caseREACT_LAZY_TYPE:{constlazyComponent:LazyComponent<any,any>=(type:any);constpayload=lazyComponent._payload;constinit=lazyComponent._init;try{//Lazymaycontainanycomponenttypesowerecursivelyresolveit.returndescribeElementType(init(payload));}catch(x){}}}}return'';}exportfunctiondescribeObjectForErrorMessage(objectOrArray:{+[key:string|number]:mixed,...}|$ReadOnlyArray<mixed>,expandedName?:string,):string{constobjKind=objectName(objectOrArray);if(objKind!=='Object'&&objKind!=='Array'){returnobjKind;}letstr='';letstart=-1;letlength=0;if(isArray(objectOrArray)){if(__DEV__&&jsxChildrenParents.has(objectOrArray)){//PrintJSXChildrenconsttype=jsxChildrenParents.get(objectOrArray);str='<'+describeElementType(type)+'>';constarray:$ReadOnlyArray<mixed>=objectOrArray;for(leti=0;i<array.length;i++){constvalue=array[i];letsubstr;if(typeofvalue==='string'){substr=value;}elseif(typeofvalue==='object'&&value!==null){substr='{'+describeObjectForErrorMessage(value)+'}';}else{substr='{'+describeValueForErrorMessage(value)+'}';}if(''+i===expandedName){start=str.length;length=substr.length;str+=substr;}elseif(substr.length<15&&str.length+substr.length<40){str+=substr;}else{str+='{...}';}}str+='</'+describeElementType(type)+'>';}else{//PrintArraystr='[';constarray:$ReadOnlyArray<mixed>=objectOrArray;for(leti=0;i<array.length;i++){if(i>0){str+=',';}constvalue=array[i];letsubstr;if(typeofvalue==='object'&&value!==null){substr=describeObjectForErrorMessage(value);}else{substr=describeValueForErrorMessage(value);}if(''+i===expandedName){start=str.length;length=substr.length;str+=substr;}elseif(substr.length<10&&str.length+substr.length<40){str+=substr;}else{str+='...';}}str+=']';}}else{if(objectOrArray.$$typeof===REACT_ELEMENT_TYPE){str='<'+describeElementType(objectOrArray.type)+'/>';}elseif(__DEV__&&jsxPropsParents.has(objectOrArray)){//PrintJSXconsttype=jsxPropsParents.get(objectOrArray);str='<'+(describeElementType(type)||'...');constobject:{+[key:string|number]:mixed,...}=objectOrArray;constnames=Object.keys(object);for(leti=0;i<names.length;i++){str+='';constname=names[i];str+=describeKeyForErrorMessage(name)+'=';constvalue=object[name];letsubstr;if(name===expandedName&&typeofvalue==='object'&&value!==null){substr=describeObjectForErrorMessage(value);}else{substr=describeValueForErrorMessage(value);}if(typeofvalue!=='string'){substr='{'+substr+'}';}if(name===expandedName){start=str.length;length=substr.length;str+=substr;}elseif(substr.length<10&&str.length+substr.length<40){str+=substr;}else{str+='...';}}str+='>';}else{//PrintObjectstr='{';constobject:{+[key:string|number]:mixed,...}=objectOrArray;constnames=Object.keys(object);for(leti=0;i<names.length;i++){if(i>0){str+=',';}constname=names[i];str+=describeKeyForErrorMessage(name)+':';constvalue=object[name];letsubstr;if(typeofvalue==='object'&&value!==null){substr=describeObjectForErrorMessage(value);}else{substr=describeValueForErrorMessage(value);}if(name===expandedName){start=str.length;length=substr.length;str+=substr;}elseif(substr.length<10&&str.length+substr.length<40){str+=substr;}else{str+='...';}}str+='}';}}if(expandedName===undefined){returnstr;}if(start>-1&&length>0){consthighlight=''.repeat(start)+'^'.repeat(length);return'\n'+str+'\n'+highlight;}return'\n'+str;}