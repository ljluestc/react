/***Copyright(c)MetaPlatforms,Inc.andaffiliates.**ThissourcecodeislicensedundertheMITlicensefoundinthe*LICENSEfileintherootdirectoryofthissourcetree.**@flow*/letdidWarnAboutMessageChannel=false;letenqueueTaskImpl=null;exportdefaultfunctionenqueueTask(task:()=>void):void{if(enqueueTaskImpl===null){try{//readrequireoffthemoduleobjecttogetaroundthebundlers.//wedon'twantthemtodetectarequireandbundleaNodepolyfill.constrequireString=('require'+Math.random()).slice(0,7);constnodeRequire=module&&module[requireString];//assumingwe'reinnode,let'strytogetnode's//versionofsetImmediate,bypassingfaketimersifany.enqueueTaskImpl=nodeRequire.call(module,'timers').setImmediate;}catch(_err){//we'reinabrowser//wecan'tuseregulartimersbecausetheymaystillbefaked//sowetryMessageChannel+postMessageinsteadenqueueTaskImpl=function(callback:()=>void){if(__DEV__){if(didWarnAboutMessageChannel===false){didWarnAboutMessageChannel=true;if(typeofMessageChannel==='undefined'){console.error('ThisbrowserdoesnothaveaMessageChannelimplementation,'+enqueuingtasksviaawaitact(async()=>...)willfail.'+'Plefileanissueathttps://github.com/facebook/react/issues'+'ifyoncounterthiswarning.',);}}}constchannel=newMessageChannel();channel.port1.onmessage=callback;channel.port2.postMessage(undefined);};}}returnenqueueTaskImpl(task);}